---
layout: default
---

<article{% if page.password_protected %} data-protected="true" class="protected-post"{% endif %}>
  {% include meta.html post=page %}
  {{ content }}
  {% if page.html_data_uri %}
  <!-- Protected HTML: base64 decoded and injected into Shadow DOM -->
  <div class="html-container">
    <div class="html-toolbar">
      <button id="html-download-btn" class="html-download-btn">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
        Download HTML
      </button>
      <button id="html-open-btn" class="html-open-btn">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/><polyline points="15 3 21 3 21 9"/><line x1="10" y1="14" x2="21" y2="3"/></svg>
        Open in New Tab
      </button>
    </div>
    <div id="html-writeup-host"></div>
  </div>
  <script>
    (function() {
      var dataUri = "{{ page.html_data_uri }}";
      var parts = dataUri.split(',');
      var raw = atob(parts[1]);
      var bytes = new Uint8Array(raw.length);
      for (var i = 0; i < raw.length; i++) bytes[i] = raw.charCodeAt(i);
      var htmlString = new TextDecoder().decode(bytes);

      // Inject into Shadow DOM (style isolation)
      var host = document.getElementById('html-writeup-host');
      var shadow = host.attachShadow({ mode: 'open' });
      var parser = new DOMParser();
      var doc = parser.parseFromString(htmlString, 'text/html');

      // Move all <style> and <link rel="stylesheet"> from head and body
      doc.querySelectorAll('style, link[rel="stylesheet"]').forEach(function(el) {
        shadow.appendChild(el.cloneNode(true));
      });
      // Wrap body content in a div (can't append <body> to shadow DOM)
      var wrapper = document.createElement('div');
      wrapper.className = doc.body.className;
      wrapper.setAttribute('style', doc.body.getAttribute('style') || '');
      wrapper.innerHTML = doc.body.innerHTML;
      shadow.appendChild(wrapper);

      // Rewrite CSS rules targeting body/html to target the wrapper instead
      shadow.querySelectorAll('style').forEach(function(styleEl) {
        styleEl.textContent = styleEl.textContent
          .replace(/\bbody\b/g, '.writeup-body')
          .replace(/\bhtml\b/g, ':host');
      });
      wrapper.classList.add('writeup-body');

      // Build blob for download/open-in-new-tab
      var blob = new Blob([bytes], { type: 'text/html' });
      var blobUrl = URL.createObjectURL(blob);

      document.getElementById('html-download-btn').addEventListener('click', function() {
        var a = document.createElement('a');
        a.href = blobUrl;
        a.download = '{{ page.protected_html | default: "writeup.html" }}';
        a.click();
      });
      document.getElementById('html-open-btn').addEventListener('click', function() {
        window.open(blobUrl, '_blank');
      });
    })();
  </script>
  {% elsif page.html_file %}
  <!-- Regular HTML: fetched and injected into Shadow DOM -->
  <div class="html-container">
    <div class="html-toolbar">
      <a href="{{ page.html_file | relative_url }}" class="html-download-btn" download>
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
        Download HTML
      </a>
      <a href="{{ page.html_file | relative_url }}" class="html-open-btn" target="_blank">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/><polyline points="15 3 21 3 21 9"/><line x1="10" y1="14" x2="21" y2="3"/></svg>
        Open in New Tab
      </a>
    </div>
    <div id="html-writeup-host"></div>
  </div>
  <script>
    (function() {
      fetch('{{ page.html_file | relative_url }}')
        .then(function(r) { return r.text(); })
        .then(function(htmlString) {
          var host = document.getElementById('html-writeup-host');
          var shadow = host.attachShadow({ mode: 'open' });
          var parser = new DOMParser();
          var doc = parser.parseFromString(htmlString, 'text/html');

          doc.querySelectorAll('style, link[rel="stylesheet"]').forEach(function(el) {
            shadow.appendChild(el.cloneNode(true));
          });
          var wrapper = document.createElement('div');
          wrapper.className = doc.body.className;
          wrapper.setAttribute('style', doc.body.getAttribute('style') || '');
          wrapper.innerHTML = doc.body.innerHTML;
          shadow.appendChild(wrapper);

          shadow.querySelectorAll('style').forEach(function(styleEl) {
            styleEl.textContent = styleEl.textContent
              .replace(/\bbody\b/g, '.writeup-body')
              .replace(/\bhtml\b/g, ':host');
          });
          wrapper.classList.add('writeup-body');
        });
    })();
  </script>
  {% endif %}

  {% if page.html_data_uri or page.html_file %}
  <style>
    .html-container {
      margin-top: 1.5em;
      border-radius: 8px;
      overflow: hidden;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
    }
    .html-toolbar {
      display: flex;
      gap: 10px;
      padding: 12px 16px;
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }
    .html-download-btn, .html-open-btn {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 8px 16px;
      border-radius: 6px;
      font-size: 14px;
      font-weight: 500;
      text-decoration: none;
      transition: all 0.2s ease;
      cursor: pointer;
      border: none;
      font-family: inherit;
    }
    .html-download-btn {
      background: #89CFF0;
      color: #1a1a2e;
    }
    .html-download-btn:hover {
      background: #a8dcf5;
      transform: translateY(-1px);
    }
    .html-open-btn {
      background: rgba(255, 255, 255, 0.1);
      color: #fff;
      border: 1px solid rgba(255, 255, 255, 0.2);
    }
    .html-open-btn:hover {
      background: rgba(255, 255, 255, 0.2);
      transform: translateY(-1px);
    }
    #html-writeup-host {
      padding: 2em;
      background: #fff;
    }
    @media (max-width: 600px) {
      .html-toolbar {
        flex-direction: column;
      }
      #html-writeup-host {
        padding: 1em;
      }
    }
  </style>
  {% endif %}
  {% if page.comments != false and site.comments.isso or site.comments.disqus %}
    <hr>
    {% if site.comments.isso_domain %}<div id="isso-thread"></div>{% endif %}
    {% if site.comments.disqus_shortname %}<div id="disqus_thread"></div>{% endif %}
    <noscript>Please enable JavaScript to view comments.</noscript>
  {% endif %}
</article>
